{% extends "base.html" %}
{% load static from staticfiles %}

{% block head_js %}
<script type="text/javascript" src="{% static 'js/script.js' %}"></script>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12 col-md-4 text-center">
    <input type="hidden" id="auction_status" name="auction_status" value="{{ item.auction_status }}"/>
    <input type="hidden" id="auction_time_start" name="auction_time_start" value="{{ item.auction_time_start }}"/>
    <input type="hidden" id="end-time-fix" name="end-time-fix" value="{{item.auction_end_time}}"/>
    <input type="hidden" id="auction-time" name="auction-time" value="{{item.auction_duration_time}}"/>
    <input type="hidden" id="user-name" name="user-name" value="{{user.username}}"/>

    <div class="timer" id="timer">
      <div class="timer" id="days"></div>
      <div class="timer" id="hours"></div>
      <div class="timer" id="minutes"></div>
      <div class="timer" id="seconds"></div>
    </div>

    {% if item.seller == user.username %}
    <div class="" id="auction_duration">
      <div class="" id="auction_time-select">
        <p>
          <span class="">Choose how long you want to auction your item: </span>
        </p>
        <input class="" type="number" id="time-quantity" name="time-quantity" min="1" max="60" value="1"/>
        <select class="" id="time-scale" name="time-scale">
          <option value="Minutes">Minutes</option>
          <option value="Hours" selected>Hours</option>
          <option value="Days">Days</option>
        </select>

        <span class="input-group-btn" id="">
          <button class="btn btn-success" id="auction-set-time" type="submit">Set</button>
        </span>
      </div>
      <div class="d-none" id="announce-time">
        <p>
          Your item will be auctioned for
          <span id="auction-time-quantity"></span>
          <span> </span>
          <span id="auction-time-scale"></span>
        </p>
      </div>

      <form method="post" action="{% url 'start_auction' item.id %}" class="accountform">
        {% csrf_token %}
        <input type="hidden" id="end-time-fix-form" name="end-time-fix-form" value="0"/>
        <input type="hidden" id="auction-time-form" name="auction-time-form" value="0"/>
        <!-- <input type="hidden" id="auction-price-form" name="auction-price-form" value="0"/> -->
        <button class="d-none btn btn-success" id="auction_start" type="submit">Start</button>
      </form>
    </div>
    {% endif %}
    
    <p class="">Initial price : <span>{{item.price}} €</span></p>
    
    
    {% if item.highest_bid_offer == item.price and item.auction_status and not item.sold %}
    <div class="d-none" id="end-auction-no-bid">
      <p>Auction is finished. No one bidded this item.</p>
    </div>

    <div class="" id="status-no-bid">
      <p>
        No bid yet!
      </p>
    </div>
    {% else %}

    <div class="d-none" id="end-auction-winner">
    {% if item.highest_bid_user == user.username %}
      {% if not item.sold%}
      <p>Congragulations!! You won this item</p>
      {% endif%}
    {% else %}
      <p>Auction is finished.</p>
      <p>Winner is: <span class="winner"><strong> {{item.highest_bid_user}}</strong><sup><i class="fas fa-trophy"></i></sup></span> by <strong>{{item.highest_bid_offer}} €</strong></p>
    {% endif %}
    </div>

    <div class="" id="status-highest">
    {% if item.highest_bid_user == user.username %}
      <p>The highest bid so far is <strong>{{item.highest_bid_offer}} €</strong> by
        <strong>You</strong>
      </p>
    {% elif item.auction_status %}
      <p>
        The highest bid so far is <strong>{{item.highest_bid_offer}} €</strong> by
        <strong>{{item.highest_bid_user}}</strong>
      </p>
    {% endif %}
    </div>
    {% endif %}


    {% if item.seller != user.username %}
    <div class="" id="before_auction">
      <p>The seller has not started the auction yet</p>
    </div>
    {% endif %}
    
    {% if item.highest_bid_user == user.username %}
    <div class="d-none" id="winner">
    {% if item.sold == 1 %}
      <div>You have already paid</div>
      <div class="">The item will ship to youdress to:</div>
    {% else%}
      <p>Now you can pay</p>
      <div class="row">
      <a href="{% url 'payment' item.id %}" class="btn btn-success" role="button"><span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>Checkout</a>
    </div>

      <p>
        If you don't pay in 24 hours you cannnot pay it anymore and you will be
        blocked from bidding this item
      </p>{% endif%}
    </div>
    
    {% endif %}
    
    
    
    
    
    
    {% if user.username and item.seller != user.username and item.auction_status %}
    <div class="" id="bidding">
      <div>Place a higher bid and win this item</div>
      {% if item.price <= 500 %}
      <button class="btn btn-danger" type="" id="1a">+1€</button>
      <button class="btn btn-danger" type="" id="5a">+5€</button>
      <button class="btn btn-danger" type="" id="10a">+10€</button>
      <button class="btn btn-danger" type="" id="20a">+20€</button>
      {% elif item.price > 500 and item.price <= 1000 %}
      <button class="btn btn-danger" type="" id="10b">+10€</button>
      <button class="btn btn-danger" type="" id="20b">+20€</button>
      <button class="btn btn-danger" type="" id="50b">+50€</button>
      <button class="btn btn-danger" type="" id="100b">+100€</button>
      {% elif item.price > 1000 and item.price <= 5000 %}
      <button class="btn btn-danger" type="" id="50c">+50€</button>
      <button class="btn btn-danger" type="" id="100c">+100€</button>
      <button class="btn btn-danger" type="" id="200c">+200€</button>
      <button class="btn btn-danger" type="" id="500c">+500€</button>
      {% else %}
      <button class="btn btn-danger" type="" id="200d">+200€</button>
      <button class="btn btn-danger" type="" id="500d">+500€</button>
      <button class="btn btn-danger" type="" id="1000d">+1000€</button>
      <button class="btn btn-danger" type="" id="5000d">+5000€</button>
      {% endif %}
    </div>
    {% elif not user.username and not item.sold%}
    <div><p>To place a bid you should first <a class="" href="{% url 'login' %}">Log In</a> or <a class="" href="{% url 'register' %}">Register</a></p></div>
    {% endif %}
  

  <div class="d-none" id="confirm-bid">Confirm your new bid </div>


  <form method="post" action="{% url 'start_auction' item.id %}" class="accountform p0">
        {% csrf_token %}
        <input type="hidden" id="form-2" name="form-2" value="1"/>
        <input type="hidden" id="higher-bid" name="higher-bid" value=""/>
        <input type="hidden" id="higher-bid-user" name="higher-bid-user" value=""/>
        <button class="d-none btn btn-success" id="higher-bid-confirm" type="submit">Confirm</button>
  </form>
  </div>



  <div class="col-12 col-md-8">
    {% if user.username %}
    <p>You are logged in as {{ user.username }}</p>
    {% else %}
    <p>To start bidding you should log in or register</p>
    {% endif %} {% if item.image %}
    <div class="img-detail-container">
      <img class="img-detail" src="/media/{{ item.image }}" />
    </div>
    {% endif %}
    <h3>{{ item.title }} ({{item.seller}})</h3>
    <p>
      <span class="boldtext"><i class="far fa-eye"></i></span> {{item.views}}
    </p>
    <p>{{ item.content }}</p>
    <div>
      <span class="boldtext"><strong>Description:</strong> {{ item.description }}</span>
    </div>
    <p class=""><span class="boldtext">#</span>{{ item.tag }}</p>
    <p><i><span class="boldtext">Published on:</span> {{ item.published_date }}</i></p>
    <p></p>
    <a href="{% url 'get_items' %}" class="btn btn-dark">Home</a>
    {% if user.username and user.username == item.seller  and not item.auction_status %}
    <a href="{% url 'edit_item' item.id%}" class="btn btn-danger">Edit</a>
    {% endif %}
    <hr />
  </div>
</div>

{% endblock %}
